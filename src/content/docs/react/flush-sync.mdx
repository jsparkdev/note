---
title: 상태 업데이트 후 바로 DOM에 접근하기
description: flushSync 함수를 사용하여 상태를 동기적으로 업데이트하는 방법을 알아봅니다.
---

import { Steps, Aside } from '@astrojs/starlight/components';

포커스 관리, 스크롤 등의 작업은 요소가 DOM에 렌더링 된 후 사용할 수 있습니다. 간혹 상태 업데이트를 통해 UI가 변경된 직후 바로 접근해야 할 수도 있습니다.

## 상태 업데이트 시기

하지만, 실제로는 상태 업데이트 함수가 호출되는 시기와 실제로 상태가 업데이트되는 시기는 완전히 다릅니다.

이는 React가 최적화를 위해 여러 상태 업데이트를 하나의 리렌더링으로 묶는 배칭(Batching)을 사용하기 때문입니다.

즉, 상태를 업데이트하는 함수를 호출한 후에는 해당 요소가 아직 존재하지 않을 수도 있습니다.

이는 상태 업데이트가 비동기적으로 실행되어 발생하는 문제이므로, 상태 업데이트를 동기적으로 실행되도록 만들면 해결할 수 있습니다.

## flushSync

상태 업데이트를 동기적으로 실행하기 위해 `flushSync` 함수를 사용할 수 있습니다.

### 사용 방법

간단한 예시를 통해 `flushSync`가 어떻게 동작하는지 알아보겠습니다.

<Steps>
1. `<input />` 요소를 토글할 수 있는 다음과 같은 코드를 준비합니다.

    ```tsx
    import { useState } from 'react';

    export default function App() {
      const [show, setShow] = useState(false);

      return (
        <main>
          <label>
            <input
              type="checkbox"
              onChange={() => {
                setShow((prev) => !prev);
              }}
            />
            Toggle
          </label>
          <div>{show ? <input /> : <div>No</div>}</div>
        </main>
      );
    }
    ```
2. 상태가 업데이트되어 `<input />` 요소가 화면에 나타나면 포커스를 제공하기 위해 `useRef`를 사용합니다.

    ```tsx "useRef" "ref={inputRef}" ins={5, 14} collapse={6-13, 15-18, 20-22}
    import { useRef, useState } from 'react';

    export default function App() {
      const [show, setShow] = useState(false);
      const inputRef = useRef<HTMLInputElement>(null);

      return (
        <main>
          <label>
            <input
              type="checkbox"
              onChange={() => {
                setShow((prev) => !prev);
                inputRef.current?.focus();
              }}
            />
            Toggle
          </label>
          <div>{show ? <input ref={inputRef} /> : <div>No</div>}</div>
        </main>
      );
    }
    ```
3. 하지만, `<input />` 요소가 화면에 나타나도 포커스는 제공되지 않습니다.

    `onChange` 이벤트 핸들러의 상태 업데이트 코드를 `flushSync`의 콜백 함수로 제공합니다.

    ```tsx ins={4-6}
    <input
      type="checkbox"
      onChange={() => {
        flushSync(() => {
          setShow((prev) => !prev);
        });
        inputRef.current?.focus();
      }}
    />
    ```
    이제 우리가 원하는대로 `<input />`이 화면에 나타나면 자동으로 포커스가 제공됩니다.
</Steps>


<Aside type="caution">
`flushSync`를 사용하면 상태 업데이트 배칭이 무시되므로 최적화를 피하는 작업을 수행합니다.

하지만, 포커스 관리와 같이 즉각적인 DOM 업데이트가 필요한 경우에는 완벽한 솔루션이 될 수도 있습니다.
</Aside>
