---
title: flushSync를 사용한 포커스 관리
description: flushSync 함수를 사용하여 상태를 동기적으로 업데이트하는 방법을 알아봅니다.
---

import { Steps, Aside } from '@astrojs/starlight/components';

포커스 관리 및 스크롤과 같은 작업은 DOM 노드가 완전히 렌더링된 후 사용할 수 있습니다. 간혹 상태가 업데이트되어 UI가 변경된 직후 바로 이 작업을 수행해야 할 수도 있습니다.

하지만, 상태 업데이트 함수가 호출되는 시점과 실제로 상태가 업데이트 되는 시점은 완전히 다를 수 있습니다. 이는 React가 최적화를 위해 여러 상태 업데이트를 하나의 리렌더링으로 묶는 배칭(Batching)을 사용하기 때문입니다.

즉, 상태 업데이트 직후 DOM에 접근하려는 시도는 실패할 수 있습니다. 해당 요소가 아직 존재하지 않을 수도 있기 때문입니다.

이는 상태 업데이트가 비동기적으로 실행되어 발생하는 문제이므로, 상태 업데이트를 동기적으로 실행되도록 만들면 해결할 수 있는 문제입니다.

이를 위해 사용할 수 있는 함수가 바로 `flushSync`입니다. 이 함수는 상태 업데이트 및 DOM 업데이트를 동기적으로 실행하도록 강요합니다.


## 사용 방법

간단한 예시를 통해 `flushSync`가 어떻게 동작하고, 어떤 문제를 해결할 수 있는지 알아보겠습니다.


<Steps>
1. `<input />` 태그를 토글할 수 있는 다음과 같은 코드를 준비합니다.

    ```tsx
    import { useState } from 'react';

    export default function App() {
      const [show, setShow] = useState(true);

      return (
        <main>
          <label>
            <input
              type="checkbox"
              onChange={() => {
                setShow((prev) => !prev);
              }}
            />
            Toggle
          </label>
          <div>{show ? <input /> : <div>No</div>}</div>
        </main>
      );
    }
    ```
2. 상태가 업데이트되어 `<input />` 태그가 화면에 나타나면 포커스를 제공하기 위해 `useRef`를 사용합니다.

    ```tsx "useRef" "ref={inputRef}" ins={5, 14} collapse={6-13, 15-18, 20-22}
    import { useRef, useState } from 'react';

    export default function App() {
      const [show, setShow] = useState(true);
      const inputRef = useRef<HTMLInputElement>(null);

      return (
        <main>
          <label>
            <input
              type="checkbox"
              onChange={() => {
                setShow((prev) => !prev);
                inputRef.current?.focus();
              }}
            />
            Toggle
          </label>
          <div>{show ? <input ref={inputRef} /> : <div>No</div>}</div>
        </main>
      );
    }
    ```
3. 하지만, `<input />` 태그가 화면에 나타나도 포커스는 제공되지 않습니다. 이 문제를 해결하기 위해 `flushSync`를 사용합니다.

    `onChange` 이벤트 핸들러의 상태 업데이트 코드를 `flushSync`의 콜백 함수로 제공합니다.

    ```tsx ins={4-6}
    <input
      type="checkbox"
      onChange={() => {
        flushSync(() => {
          setShow((prev) => !prev);
        });
        inputRef.current?.focus();
      }}
    />
    ```
    이제 우리가 원하는대로 `<input />`이 화면에 나타나면 자동으로 포커스가 제공됩니다.
</Steps>


<Aside type="caution">
`flushSync`를 사용하면 상태 업데이트 배칭이 무시되므로 최적화를 피하는 작업을 수행합니다.

하지만, 포커스 관리와 같은 특수한 경우에는 완벽한 솔루션이 될 수도 있습니다.
</Aside>
