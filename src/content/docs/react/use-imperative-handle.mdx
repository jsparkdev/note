---
title: 하위 컴포넌트의 메서드 및 속성에 액세스
description: useImperativeHandle을 사용하여 사용자 정의 컴포넌트에서 자식 컴포넌트의 메서드 및 속성을 노출하는 방법을 알아봅니다.
---

React에서 상위 컴포넌트와 하위 컴포넌트 간 상호작용은 주로 props를 통해 이루어집니다. 이는 상위 컴포넌트에서 하위 컴포넌트로 데이터를 전달할 뿐입니다.

상위 컴포넌트가 하위 컴포넌트의 메서드나 속성을 사용해야 할 수도 있습니다.

이를 위해 `useImperativeHandle`를 사용할 수 있습니다.

## 사용 방법

우리는 버튼을 클릭하면 `CustomInput`이 렌더링하는 `<input />`에 포커스가 제공되기를 원합니다.

```tsx
function CustomInput() {
  return <input type="text" />;
}

export default function App() {
  return (
    <main>
      <CustomInput />
      <button type="button">Focus ON</button>
    </main>
  );
}
```

이를 위해 다음 조건이 만족되어야 합니다.

- `App` 컴포넌트는 `<input />` 요소가 가지고 있는 메서드에 접근할 수 있어야 합니다.
- 즉, `CustomInput` 컴포넌트는 `<input />` 요소가 가지고 있는 메서드를 `App` 컴포넌트에 전달하는 역할을 해야합니다.

가장 간단한 아이디어는 다음 코드와 같이 `ref.current`를 재정의하는 것입니다.

```tsx "type RefObject" "ref={inputRef}" "customInputRef={customInputRef}" "onClick={() => customInputRef.current?.focus()}" ins={3-5, 8, 10, 12, 14-18, 24}
import { type RefObject, useRef } from "react";

type CustomInputAPI = {
  focus: () => void;
};

function CustomInput({
  customInputRef,
}: {
  customInputRef: RefObject<CustomInputAPI | null>;
}) {
  const inputRef = useRef<HTMLInputElement>(null);

  customInputRef.current = {
    focus: () => {
      inputRef.current?.focus();
    },
  };

  return <input type="text" ref={inputRef} />;
}

export default function App() {
  const customInputRef = useRef<CustomInputAPI>(null);

  return (
    <main>
      <CustomInput customInputRef={customInputRef} />
      <button type="button" onClick={() => customInputRef.current?.focus()}>
        Focus ON
      </button>
    </main>
  );
}
```

하지만 `customInputRef.current` 객체를 덮어쓰는 방법은 다음과 같은 단점이 존재합니다.

- 컴포넌트가 리렌더링될 때마다 객체가 새로 생성되어 메모리가 누수되고, 일관된 참조를 유지하지 못합니다.
- Suspense로 인해 렌더링이 중단되고 다시 시작될 때 객체에 예상치 못한 값이 할당될 수 있습니다.
- 매 렌더링마다 객체가 달라지므로 여러 번 렌더링하는 Concurrent 모드에서 예상치 못한 문제가 발생할 수 있습니다.

이러한 최신 기능들과의 호환성 문제로 인해 객체를 덮어쓰는 방법 대신 `useImperativeHandle`을 사용하는 것이 권장됩니다.

```tsx del={1-5} ins={6-8}
customInputRef.current = {
  focus: () => {
    inputRef.current?.focus();
  },
};
useImperativeHandle(customInputRef, () => ({
  focus: () => inputRef.current?.focus(),
}));
```

## 주의 사항

import { Aside } from '@astrojs/starlight/components';

- 과도하게 사용하면 컴포넌트 간 결합도가 높아지고, 코드 예측 가능성이 낮아지므로 신중하게 사용해야 합니다.
- React의 선언적 프로그래밍 패러다임과 상반되므로 신중하게 사용해야 합니다.

<Aside title="권장되는 경우">
- 상위 컴포넌트가 하위 컴포넌트의 메서드나 속성을 사용해야 하는 경우에 사용하는 것이 권장됩니다.
- 이는 주로 DOM을 직접 제어하는 경우 (포커스, 스크롤, 크기 측정 등)입니다.
</Aside>
