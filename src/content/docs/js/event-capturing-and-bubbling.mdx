---
title: 이벤트 캡처링과 버블링
description: JavaScript로 추가한 이벤트가 어떤 순서로 전파되는지 알아보고, 이벤트 캡처링과 버블링이 무엇인지에 대해 알아봅니다.
---

import { Steps, Card, Aside } from '@astrojs/starlight/components';

이벤트는 다음 순서대로 전파됩니다.

<Steps>

1. **이벤트 캡처링** 단계

    이벤트가 DOM 트리의 최상위 요소에서 최하위 요소까지 내려가면서 전파됩니다.

    <Card title="이벤트 캡처링">
    버튼 클릭 시 이벤트는 다음 순서로 전파됩니다.

    `window` &rarr; `document` &rarr; `<html>` &rarr; `<body>` &rarr; `<div>` &rarr; `<button>`
    </Card>

    <Aside type="tip">
    기본적으로 이벤트 캡처링은 [별도의 설정](https://developer.mozilla.org/ko/docs/Web/API/EventTarget/addEventListener#capture)을 하지 않으면 발생하지 않습니다.
    </Aside>

2. 이벤트가 최하위 요소에 도달합니다. 이 요소를 타겟 요소라고 합니다.

    <Aside type="caution">타겟 요소는 이벤트 핸들러가 연결된 요소가 아닐 수도 있습니다.</Aside>

3. **이벤트 버블링** 단계

    타겟 요소에 도달한 이벤트는 다시 최상위 요소를 향해 전파됩니다.

    <Card title="이벤트 버블링">`<button>` &rarr; `<div>` &rarr; `<body>` &rarr; `<html>` &rarr; `document` &rarr; `window`</Card>

    <Aside type="tip">대부분의 이벤트가 이 단계에서 처리됩니다.</Aside>
</Steps>

## 이벤트 버블링 방지

이벤트 버블링을 방지하는 방법은 크게 두 가지가 있습니다.

### `stopPropagation()`

- 현재 이벤트의 버블링을 비활성화합니다.
- 요소에 여러 이벤트 리스너가 추가되어 있는 경우, 다른 이벤트는 모두 정상적으로 전파됩니다.

### `stopImmediatePropagation()`

- 현재 이벤트의 버블링을 비활성화합니다.
- 요소에 여러 이벤트 리스너가 추가되어 있는 경우, 다른 이벤트도 모두 전파되지 않습니다.

## 이벤트 위임

여러 하위 요소에 동일한 이벤트를 추가해야 하는 경우, 대신 하나의 상위 요소에 이벤트 리스너를 추가하여 더 효율적인 코드를 작성할 수 있습니다.

여러 버튼에 각각 이벤트 리스너를 추가하는 코드를 통해 알아보겠습니다.

```html
<ul class="wrapper">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
  <button>6</button>
  <button>7</button>
</ul>
```

다음 코드를 통해 각 버튼에 이벤트를 추가할 수 있습니다.

```js
const buttonList = document.querySelectorAll('button');
buttonList.forEach((button) =>
  button.addEventListener('click', () => {
    console.log(button.textContent);
  })
);
```

이는 잘 동작하지만, 다음과 같은 단점이 존재합니다.

- 많은 이벤트 리스너를 추가하기 때문에 메모리를 사용량이 증가합니다.
- 새로 추가되는 동적 요소에는 이벤트 리스너가 추가되지 않습니다.

이 문제를 해결하기 위해 **이벤트 위임**을 사용할 수 있습니다.

```js
const wrapper = document.querySelector('.wrapper');
wrapper.addEventListener('click', (event) => {
  const { target } = event;
  const button = target.closest('button');

  if (button) {
    console.log(button.textContent);
  } else {
    console.log('버튼이 아닌 요소를 클릭하였습니다!');
  }
});
```

- `target`을 사용하여 이벤트가 트리거된 DOM트리의 최하위 요소를 가져옵니다.
- `closest()`를 사용하여 최하위 요소에서 가장 가까운 `button` 요소를 찾습니다.

<Aside type="tip" title="React의 이벤트 위임">
- React는 브라우저 네이티브 이벤트를 감싸는 합성 이벤트 (Synthetic Events)를 사용합니다.
- 이를 통해 모든 이벤트 리스너를 루트 컨테이너에 연결합니다. 이는 React가 내부적으로 이벤트를 최적화하여 이벤트 위임을 구현한다는 것을 의미합니다.
</Aside>
